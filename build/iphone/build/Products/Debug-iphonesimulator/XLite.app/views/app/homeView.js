const homeController = require('/controllers/app/homeController');

module.exports = function () {
  const HEADER_HEIGHT = 56;
  const TAB_BAR_HEIGHT = 44;
  const NAV_BAR_HEIGHT = 54;
  const safeTop = "iphone" === "iphone" && Ti.Platform.safeAreaPadding ?
  Ti.Platform.safeAreaPadding.top :
  44;

  const win = Ti.UI.createWindow({
    backgroundColor: '#000',
    title: 'All Tweets',
    navBarHidden: true
  });

  // --- HEADER ---
  const header = Ti.UI.createView({
    top: safeTop,
    left: 0, right: 0,
    height: HEADER_HEIGHT,
    backgroundColor: '#000',
    layout: 'absolute',
    zIndex: 100
  });

  const profileAvatar = Ti.UI.createImageView({
    image: '/assets/images/demo_profile.png',
    width: 34, height: 34,
    borderRadius: 17,
    left: 16, top: 11,
    touchEnabled: true,
    zIndex: 101
  });

  const xLogo = Ti.UI.createImageView({
    image: '/assets/images/X_neww.png',
    width: 55, height: 36,
    top: 10,
    zIndex: 102
  });
  xLogo.addEventListener('postlayout', function () {
    xLogo.left = (Ti.Platform.displayCaps.platformWidth - xLogo.width) / 2;
  });

  header.add(profileAvatar);
  header.add(xLogo);
  win.add(header);

  // --- TABS: For You / Following ---
  let currentTab = 0;
  let tableView;
  let forYouRows = [];
  let followingRows = [];

  const tabsBar = Ti.UI.createView({
    top: safeTop + HEADER_HEIGHT,
    left: 0, right: 0,
    height: TAB_BAR_HEIGHT,
    backgroundColor: '#000',
    layout: 'horizontal'
  });

  const forYouLabel = Ti.UI.createLabel({
    text: 'For You',
    color: '#fff',
    font: { fontSize: 16, fontWeight: 'bold' },
    width: '50%',
    textAlign: 'center'
  });
  const followingLabel = Ti.UI.createLabel({
    text: 'Following',
    color: '#888',
    font: { fontSize: 16, fontWeight: 'normal' },
    width: '50%',
    textAlign: 'center'
  });

  tabsBar.add(forYouLabel);
  tabsBar.add(followingLabel);
  win.add(tabsBar);

  // --- Hamburger menu (profile avatar tap) ---
  profileAvatar.addEventListener('click', () => {
    const dialog = Ti.UI.createOptionDialog({
      options: ['Log Out', 'Cancel'],
      cancel: 1,
      title: 'Menu'
    });
    dialog.addEventListener('click', function (e) {
      if (e.index === 0) {
        Ti.App.Properties.setBool('isLoggedIn', false);
        const createLoginView = require('/views/auth/loginView');
        createLoginView().open();
        win.close();
      }
    });
    dialog.show();
  });

  // --- Helper for tweet row ---
  function createRow(post) {
    const row = Ti.UI.createTableViewRow({
      backgroundColor: '#000',
      selectionStyle: 'none',
      height: Ti.UI.SIZE
    });
    row.tweet = post;

    const tweetRow = Ti.UI.createView({
      layout: 'horizontal',
      backgroundColor: 'transparent',
      top: 12,
      left: 0,
      right: 0,
      bottom: 12,
      height: Ti.UI.SIZE
    });

    const avatar = Ti.UI.createImageView({
      image: post.avatar,
      width: 44, height: 44,
      borderRadius: 22,
      backgroundColor: '#333',
      left: 16
    });

    const contentCol = Ti.UI.createView({
      layout: 'vertical',
      left: 16,
      right: 16,
      height: Ti.UI.SIZE
    });

    const usernameLabel = Ti.UI.createLabel({
      text: '@' + post.username,
      color: '#fff',
      font: { fontSize: 15, fontWeight: 'bold' },
      left: 0, top: 0
    });

    const tweetLabel = Ti.UI.createLabel({
      text: post.title + '\n' + post.body,
      color: '#e9e9e9',
      font: { fontSize: 15 },
      top: 4, left: 0, right: 0
    });

    contentCol.add(usernameLabel);
    contentCol.add(tweetLabel);
    tweetRow.add(avatar);
    tweetRow.add(contentCol);
    row.add(tweetRow);

    const separator = Ti.UI.createView({
      height: 1.5,
      width: Ti.UI.FILL,
      backgroundColor: '#282828',
      bottom: 0,
      left: 0
    });
    row.add(separator);

    return row;
  }

  // --- Load data and set up TableView ---
  homeController.loadHomeData((posts) => {
    if (posts.length > 0 && posts[0].avatar) {
      profileAvatar.image = posts[0].avatar;
    }

    forYouRows = posts.map((post) => createRow(post));
    followingRows = posts.
    filter((post, idx) => idx % 3 === 0).
    map((post) => createRow(post));

    tableView = Ti.UI.createTableView({
      data: forYouRows,
      backgroundColor: '#000',
      separatorColor: 'transparent',
      top: safeTop + HEADER_HEIGHT + TAB_BAR_HEIGHT,
      bottom: NAV_BAR_HEIGHT
    });

    tableView.addEventListener('click', function (e) {
      if (e.row && e.row.tweet) {
        const createTweetDetailView = require('/views/app/tweetDetailView');
        if (Ti.App.navWin) {
          Ti.App.navWin.openWindow(createTweetDetailView(e.row.tweet));
        } else {
          createTweetDetailView(e.row.tweet).open();
        }
      }
    });

    win.add(tableView);

    forYouLabel.addEventListener('click', function () {
      currentTab = 0;
      forYouLabel.font = { fontSize: 16, fontWeight: 'bold' };
      forYouLabel.color = '#fff';
      followingLabel.font = { fontSize: 16, fontWeight: 'normal' };
      followingLabel.color = '#888';
      tableView.setData(forYouRows);
    });
    followingLabel.addEventListener('click', function () {
      currentTab = 1;
      forYouLabel.font = { fontSize: 16, fontWeight: 'normal' };
      forYouLabel.color = '#888';
      followingLabel.font = { fontSize: 16, fontWeight: 'bold' };
      followingLabel.color = '#fff';
      tableView.setData(followingRows);
    });
  },
  (error) => {
    alert('Error loading tweets!');
  });

  // --- BOTTOM NAVIGATION BAR (local PNG icons) ---
  const navBar = Ti.UI.createView({
    left: 0, right: 0,
    bottom: 0,
    height: NAV_BAR_HEIGHT,
    backgroundColor: '#000',
    zIndex: 500,
    layout: 'horizontal'
  });

  // Use local paths for icons (matching your screenshot)
  const navIcons = [
  { path: '/assets/images/home.png', label: 'Home' },
  { path: '/assets/images/search.png', label: 'Search' },
  { path: '/assets/images/notification.png', label: 'Notifications' },
  { path: '/assets/images/messages.png', label: 'Messages' }];


  navIcons.forEach(function (iconObj) {
    const iconBtn = Ti.UI.createView({
      width: Ti.Platform.displayCaps.platformWidth / navIcons.length,
      height: NAV_BAR_HEIGHT,
      layout: 'vertical'
    });
    const icon = Ti.UI.createImageView({
      image: iconObj.path,
      width: 28, height: 28,
      top: 13
    });
    iconBtn.add(icon);
    iconBtn.addEventListener('click', function () {
      const dummyWin = Ti.UI.createWindow({
        backgroundColor: '#000',
        title: iconObj.label,
        navBarHidden: false
      });
      if (Ti.App.navWin) Ti.App.navWin.openWindow(dummyWin);else
      dummyWin.open();
    });
    navBar.add(iconBtn);
  });

  win.add(navBar);

  return win;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVcsQ0FBQ0MsYUFBYSxHQUFHOEQsUUFBUSxDQUFDZCxNQUFNO01BQzlENUQsTUFBTSxFQUFFaEIsY0FBYztNQUN0QmlCLE1BQU0sRUFBRTtJQUNaLENBQUMsQ0FBQztJQUNGLE1BQU0rRSxJQUFJLEdBQUc5RixFQUFFLENBQUNLLEVBQUUsQ0FBQ2EsZUFBZSxDQUFDO01BQy9CQyxLQUFLLEVBQUV5RSxPQUFPLENBQUNILElBQUk7TUFDbkJyRSxLQUFLLEVBQUUsRUFBRSxFQUFFTixNQUFNLEVBQUUsRUFBRTtNQUNyQlgsR0FBRyxFQUFFO0lBQ1QsQ0FBQyxDQUFDO0lBQ0YwRixPQUFPLENBQUNsRSxHQUFHLENBQUNtRSxJQUFJLENBQUM7SUFDakJELE9BQU8sQ0FBQ3JFLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxZQUFXO01BQ3pDLE1BQU11RSxRQUFRLEdBQUcvRixFQUFFLENBQUNLLEVBQUUsQ0FBQ0MsWUFBWSxDQUFDO1FBQ2hDQyxlQUFlLEVBQUUsTUFBTTtRQUN2QkMsS0FBSyxFQUFFb0YsT0FBTyxDQUFDRixLQUFLO1FBQ3BCakYsWUFBWSxFQUFFO01BQ2xCLENBQUMsQ0FBQztNQUNGLElBQUlULEVBQUUsQ0FBQ2dELEdBQUcsQ0FBQ2tDLE1BQU0sRUFBRWxGLEVBQUUsQ0FBQ2dELEdBQUcsQ0FBQ2tDLE1BQU0sQ0FBQ0MsVUFBVSxDQUFDWSxRQUFRLENBQUMsQ0FBQztNQUNqREEsUUFBUSxDQUFDM0MsSUFBSSxFQUFFO0lBQ3hCLENBQUMsQ0FBQztJQUNGbUMsTUFBTSxDQUFDNUQsR0FBRyxDQUFDa0UsT0FBTyxDQUFDO0VBQ3ZCLENBQUMsQ0FBQzs7RUFFRnpGLEdBQUcsQ0FBQ3VCLEdBQUcsQ0FBQzRELE1BQU0sQ0FBQzs7RUFFZixPQUFPbkYsR0FBRztBQUNkLENBQUMiLCJuYW1lcyI6WyJob21lQ29udHJvbGxlciIsInJlcXVpcmUiLCJtb2R1bGUiLCJleHBvcnRzIiwiSEVBREVSX0hFSUdIVCIsIlRBQl9CQVJfSEVJR0hUIiwiTkFWX0JBUl9IRUlHSFQiLCJzYWZlVG9wIiwiVGkiLCJQbGF0Zm9ybSIsInNhZmVBcmVhUGFkZGluZyIsInRvcCIsIndpbiIsIlVJIiwiY3JlYXRlV2luZG93IiwiYmFja2dyb3VuZENvbG9yIiwidGl0bGUiLCJuYXZCYXJIaWRkZW4iLCJoZWFkZXIiLCJjcmVhdGVWaWV3IiwibGVmdCIsInJpZ2h0IiwiaGVpZ2h0IiwibGF5b3V0IiwiekluZGV4IiwicHJvZmlsZUF2YXRhciIsImNyZWF0ZUltYWdlVmlldyIsImltYWdlIiwid2lkdGgiLCJib3JkZXJSYWRpdXMiLCJ0b3VjaEVuYWJsZWQiLCJ4TG9nbyIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNwbGF5Q2FwcyIsInBsYXRmb3JtV2lkdGgiLCJhZGQiLCJjdXJyZW50VGFiIiwidGFibGVWaWV3IiwiZm9yWW91Um93cyIsImZvbGxvd2luZ1Jvd3MiLCJ0YWJzQmFyIiwiZm9yWW91TGFiZWwiLCJjcmVhdGVMYWJlbCIsInRleHQiLCJjb2xvciIsImZvbnQiLCJmb250U2l6ZSIsImZvbnRXZWlnaHQiLCJ0ZXh0QWxpZ24iLCJmb2xsb3dpbmdMYWJlbCIsImRpYWxvZyIsImNyZWF0ZU9wdGlvbkRpYWxvZyIsIm9wdGlvbnMiLCJjYW5jZWwiLCJlIiwiaW5kZXgiLCJBcHAiLCJQcm9wZXJ0aWVzIiwic2V0Qm9vbCIsImNyZWF0ZUxvZ2luVmlldyIsIm9wZW4iLCJjbG9zZSIsInNob3ciLCJjcmVhdGVSb3ciLCJwb3N0Iiwicm93IiwiY3JlYXRlVGFibGVWaWV3Um93Iiwic2VsZWN0aW9uU3R5bGUiLCJTSVpFIiwidHdlZXQiLCJ0d2VldFJvdyIsImJvdHRvbSIsImF2YXRhciIsImNvbnRlbnRDb2wiLCJ1c2VybmFtZUxhYmVsIiwidXNlcm5hbWUiLCJ0d2VldExhYmVsIiwiYm9keSIsInNlcGFyYXRvciIsIkZJTEwiLCJsb2FkSG9tZURhdGEiLCJwb3N0cyIsImxlbmd0aCIsIm1hcCIsImZpbHRlciIsImlkeCIsImNyZWF0ZVRhYmxlVmlldyIsImRhdGEiLCJzZXBhcmF0b3JDb2xvciIsImNyZWF0ZVR3ZWV0RGV0YWlsVmlldyIsIm5hdldpbiIsIm9wZW5XaW5kb3ciLCJzZXREYXRhIiwiZXJyb3IiLCJhbGVydCIsIm5hdkJhciIsIm5hdkljb25zIiwicGF0aCIsImxhYmVsIiwiZm9yRWFjaCIsImljb25PYmoiLCJpY29uQnRuIiwiaWNvbiIsImR1bW15V2luIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvYWRpdGlzdXJ5YXdhbnNoaS92c2NvZGUvVW5pcXVlIFNjaG9vbHMvWExpdGUvUmVzb3VyY2VzL3ZpZXdzL2FwcCIsInNvdXJjZXMiOlsiaG9tZVZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaG9tZUNvbnRyb2xsZXIgPSByZXF1aXJlKCcvY29udHJvbGxlcnMvYXBwL2hvbWVDb250cm9sbGVyJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgSEVBREVSX0hFSUdIVCA9IDU2O1xuICAgIGNvbnN0IFRBQl9CQVJfSEVJR0hUID0gNDQ7XG4gICAgY29uc3QgTkFWX0JBUl9IRUlHSFQgPSA1NDtcbiAgICBjb25zdCBzYWZlVG9wID0gKFRpLlBsYXRmb3JtLm9zbmFtZSA9PT0gXCJpcGhvbmVcIiAmJiBUaS5QbGF0Zm9ybS5zYWZlQXJlYVBhZGRpbmcpXG4gICAgICAgID8gVGkuUGxhdGZvcm0uc2FmZUFyZWFQYWRkaW5nLnRvcFxuICAgICAgICA6IDQ0O1xuXG4gICAgY29uc3Qgd2luID0gVGkuVUkuY3JlYXRlV2luZG93KHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzAwMCcsXG4gICAgICAgIHRpdGxlOiAnQWxsIFR3ZWV0cycsXG4gICAgICAgIG5hdkJhckhpZGRlbjogdHJ1ZVxuICAgIH0pO1xuXG4gICAgLy8gLS0tIEhFQURFUiAtLS1cbiAgICBjb25zdCBoZWFkZXIgPSBUaS5VSS5jcmVhdGVWaWV3KHtcbiAgICAgICAgdG9wOiBzYWZlVG9wLFxuICAgICAgICBsZWZ0OiAwLCByaWdodDogMCxcbiAgICAgICAgaGVpZ2h0OiBIRUFERVJfSEVJR0hULFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMDAwJyxcbiAgICAgICAgbGF5b3V0OiAnYWJzb2x1dGUnLFxuICAgICAgICB6SW5kZXg6IDEwMFxuICAgIH0pO1xuXG4gICAgY29uc3QgcHJvZmlsZUF2YXRhciA9IFRpLlVJLmNyZWF0ZUltYWdlVmlldyh7XG4gICAgICAgIGltYWdlOiAnL2Fzc2V0cy9pbWFnZXMvZGVtb19wcm9maWxlLnBuZycsXG4gICAgICAgIHdpZHRoOiAzNCwgaGVpZ2h0OiAzNCxcbiAgICAgICAgYm9yZGVyUmFkaXVzOiAxNyxcbiAgICAgICAgbGVmdDogMTYsIHRvcDogMTEsXG4gICAgICAgIHRvdWNoRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgekluZGV4OiAxMDFcbiAgICB9KTtcblxuICAgIGNvbnN0IHhMb2dvID0gVGkuVUkuY3JlYXRlSW1hZ2VWaWV3KHtcbiAgICAgICAgaW1hZ2U6ICcvYXNzZXRzL2ltYWdlcy9YX25ld3cucG5nJyxcbiAgICAgICAgd2lkdGg6IDU1LCBoZWlnaHQ6IDM2LFxuICAgICAgICB0b3A6IDEwLFxuICAgICAgICB6SW5kZXg6IDEwMlxuICAgIH0pO1xuICAgIHhMb2dvLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RsYXlvdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgeExvZ28ubGVmdCA9IChUaS5QbGF0Zm9ybS5kaXNwbGF5Q2Fwcy5wbGF0Zm9ybVdpZHRoIC0geExvZ28ud2lkdGgpIC8gMjtcbiAgICB9KTtcblxuICAgIGhlYWRlci5hZGQocHJvZmlsZUF2YXRhcik7XG4gICAgaGVhZGVyLmFkZCh4TG9nbyk7XG4gICAgd2luLmFkZChoZWFkZXIpO1xuXG4gICAgLy8gLS0tIFRBQlM6IEZvciBZb3UgLyBGb2xsb3dpbmcgLS0tXG4gICAgbGV0IGN1cnJlbnRUYWIgPSAwO1xuICAgIGxldCB0YWJsZVZpZXc7XG4gICAgbGV0IGZvcllvdVJvd3MgPSBbXTtcbiAgICBsZXQgZm9sbG93aW5nUm93cyA9IFtdO1xuXG4gICAgY29uc3QgdGFic0JhciA9IFRpLlVJLmNyZWF0ZVZpZXcoe1xuICAgICAgICB0b3A6IHNhZmVUb3AgKyBIRUFERVJfSEVJR0hULFxuICAgICAgICBsZWZ0OiAwLCByaWdodDogMCxcbiAgICAgICAgaGVpZ2h0OiBUQUJfQkFSX0hFSUdIVCxcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzAwMCcsXG4gICAgICAgIGxheW91dDogJ2hvcml6b250YWwnXG4gICAgfSk7XG5cbiAgICBjb25zdCBmb3JZb3VMYWJlbCA9IFRpLlVJLmNyZWF0ZUxhYmVsKHtcbiAgICAgICAgdGV4dDogJ0ZvciBZb3UnLFxuICAgICAgICBjb2xvcjogJyNmZmYnLFxuICAgICAgICBmb250OiB7IGZvbnRTaXplOiAxNiwgZm9udFdlaWdodDogJ2JvbGQnIH0sXG4gICAgICAgIHdpZHRoOiAnNTAlJyxcbiAgICAgICAgdGV4dEFsaWduOiAnY2VudGVyJ1xuICAgIH0pO1xuICAgIGNvbnN0IGZvbGxvd2luZ0xhYmVsID0gVGkuVUkuY3JlYXRlTGFiZWwoe1xuICAgICAgICB0ZXh0OiAnRm9sbG93aW5nJyxcbiAgICAgICAgY29sb3I6ICcjODg4JyxcbiAgICAgICAgZm9udDogeyBmb250U2l6ZTogMTYsIGZvbnRXZWlnaHQ6ICdub3JtYWwnIH0sXG4gICAgICAgIHdpZHRoOiAnNTAlJyxcbiAgICAgICAgdGV4dEFsaWduOiAnY2VudGVyJ1xuICAgIH0pO1xuXG4gICAgdGFic0Jhci5hZGQoZm9yWW91TGFiZWwpO1xuICAgIHRhYnNCYXIuYWRkKGZvbGxvd2luZ0xhYmVsKTtcbiAgICB3aW4uYWRkKHRhYnNCYXIpO1xuXG4gICAgLy8gLS0tIEhhbWJ1cmdlciBtZW51IChwcm9maWxlIGF2YXRhciB0YXApIC0tLVxuICAgIHByb2ZpbGVBdmF0YXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGRpYWxvZyA9IFRpLlVJLmNyZWF0ZU9wdGlvbkRpYWxvZyh7XG4gICAgICAgICAgICBvcHRpb25zOiBbJ0xvZyBPdXQnLCAnQ2FuY2VsJ10sXG4gICAgICAgICAgICBjYW5jZWw6IDEsXG4gICAgICAgICAgICB0aXRsZTogJ01lbnUnXG4gICAgICAgIH0pO1xuICAgICAgICBkaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS5pbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIFRpLkFwcC5Qcm9wZXJ0aWVzLnNldEJvb2woJ2lzTG9nZ2VkSW4nLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgY3JlYXRlTG9naW5WaWV3ID0gcmVxdWlyZSgnL3ZpZXdzL2F1dGgvbG9naW5WaWV3Jyk7XG4gICAgICAgICAgICAgICAgY3JlYXRlTG9naW5WaWV3KCkub3BlbigpO1xuICAgICAgICAgICAgICAgIHdpbi5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZGlhbG9nLnNob3coKTtcbiAgICB9KTtcblxuICAgIC8vIC0tLSBIZWxwZXIgZm9yIHR3ZWV0IHJvdyAtLS1cbiAgICBmdW5jdGlvbiBjcmVhdGVSb3cocG9zdCkge1xuICAgICAgICBjb25zdCByb3cgPSBUaS5VSS5jcmVhdGVUYWJsZVZpZXdSb3coe1xuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzAwMCcsXG4gICAgICAgICAgICBzZWxlY3Rpb25TdHlsZTogJ25vbmUnLFxuICAgICAgICAgICAgaGVpZ2h0OiBUaS5VSS5TSVpFXG4gICAgICAgIH0pO1xuICAgICAgICByb3cudHdlZXQgPSBwb3N0O1xuXG4gICAgICAgIGNvbnN0IHR3ZWV0Um93ID0gVGkuVUkuY3JlYXRlVmlldyh7XG4gICAgICAgICAgICBsYXlvdXQ6ICdob3Jpem9udGFsJyxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIHRvcDogMTIsXG4gICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgICAgICBib3R0b206IDEyLFxuICAgICAgICAgICAgaGVpZ2h0OiBUaS5VSS5TSVpFXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGF2YXRhciA9IFRpLlVJLmNyZWF0ZUltYWdlVmlldyh7XG4gICAgICAgICAgICBpbWFnZTogcG9zdC5hdmF0YXIsXG4gICAgICAgICAgICB3aWR0aDogNDQsIGhlaWdodDogNDQsXG4gICAgICAgICAgICBib3JkZXJSYWRpdXM6IDIyLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzMzMycsXG4gICAgICAgICAgICBsZWZ0OiAxNlxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjb250ZW50Q29sID0gVGkuVUkuY3JlYXRlVmlldyh7XG4gICAgICAgICAgICBsYXlvdXQ6ICd2ZXJ0aWNhbCcsXG4gICAgICAgICAgICBsZWZ0OiAxNixcbiAgICAgICAgICAgIHJpZ2h0OiAxNixcbiAgICAgICAgICAgIGhlaWdodDogVGkuVUkuU0laRVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB1c2VybmFtZUxhYmVsID0gVGkuVUkuY3JlYXRlTGFiZWwoe1xuICAgICAgICAgICAgdGV4dDogJ0AnICsgcG9zdC51c2VybmFtZSxcbiAgICAgICAgICAgIGNvbG9yOiAnI2ZmZicsXG4gICAgICAgICAgICBmb250OiB7IGZvbnRTaXplOiAxNSwgZm9udFdlaWdodDogJ2JvbGQnIH0sXG4gICAgICAgICAgICBsZWZ0OiAwLCB0b3A6IDBcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgdHdlZXRMYWJlbCA9IFRpLlVJLmNyZWF0ZUxhYmVsKHtcbiAgICAgICAgICAgIHRleHQ6IHBvc3QudGl0bGUgKyAnXFxuJyArIHBvc3QuYm9keSxcbiAgICAgICAgICAgIGNvbG9yOiAnI2U5ZTllOScsXG4gICAgICAgICAgICBmb250OiB7IGZvbnRTaXplOiAxNSB9LFxuICAgICAgICAgICAgdG9wOiA0LCBsZWZ0OiAwLCByaWdodDogMFxuICAgICAgICB9KTtcblxuICAgICAgICBjb250ZW50Q29sLmFkZCh1c2VybmFtZUxhYmVsKTtcbiAgICAgICAgY29udGVudENvbC5hZGQodHdlZXRMYWJlbCk7XG4gICAgICAgIHR3ZWV0Um93LmFkZChhdmF0YXIpO1xuICAgICAgICB0d2VldFJvdy5hZGQoY29udGVudENvbCk7XG4gICAgICAgIHJvdy5hZGQodHdlZXRSb3cpO1xuXG4gICAgICAgIGNvbnN0IHNlcGFyYXRvciA9IFRpLlVJLmNyZWF0ZVZpZXcoe1xuICAgICAgICAgICAgaGVpZ2h0OiAxLjUsXG4gICAgICAgICAgICB3aWR0aDogVGkuVUkuRklMTCxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyMyODI4MjgnLFxuICAgICAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICAgICAgbGVmdDogMFxuICAgICAgICB9KTtcbiAgICAgICAgcm93LmFkZChzZXBhcmF0b3IpO1xuXG4gICAgICAgIHJldHVybiByb3c7XG4gICAgfVxuXG4gICAgLy8gLS0tIExvYWQgZGF0YSBhbmQgc2V0IHVwIFRhYmxlVmlldyAtLS1cbiAgICBob21lQ29udHJvbGxlci5sb2FkSG9tZURhdGEoKHBvc3RzKSA9PiB7XG4gICAgICAgIGlmIChwb3N0cy5sZW5ndGggPiAwICYmIHBvc3RzWzBdLmF2YXRhcikge1xuICAgICAgICAgICAgcHJvZmlsZUF2YXRhci5pbWFnZSA9IHBvc3RzWzBdLmF2YXRhcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvcllvdVJvd3MgPSBwb3N0cy5tYXAocG9zdCA9PiBjcmVhdGVSb3cocG9zdCkpO1xuICAgICAgICBmb2xsb3dpbmdSb3dzID0gcG9zdHNcbiAgICAgICAgICAgIC5maWx0ZXIoKHBvc3QsIGlkeCkgPT4gaWR4ICUgMyA9PT0gMClcbiAgICAgICAgICAgIC5tYXAocG9zdCA9PiBjcmVhdGVSb3cocG9zdCkpO1xuXG4gICAgICAgIHRhYmxlVmlldyA9IFRpLlVJLmNyZWF0ZVRhYmxlVmlldyh7XG4gICAgICAgICAgICBkYXRhOiBmb3JZb3VSb3dzLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzAwMCcsXG4gICAgICAgICAgICBzZXBhcmF0b3JDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgIHRvcDogc2FmZVRvcCArIEhFQURFUl9IRUlHSFQgKyBUQUJfQkFSX0hFSUdIVCxcbiAgICAgICAgICAgIGJvdHRvbTogTkFWX0JBUl9IRUlHSFRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGFibGVWaWV3LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgaWYgKGUucm93ICYmIGUucm93LnR3ZWV0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3JlYXRlVHdlZXREZXRhaWxWaWV3ID0gcmVxdWlyZSgnL3ZpZXdzL2FwcC90d2VldERldGFpbFZpZXcnKTtcbiAgICAgICAgICAgICAgICBpZiAoVGkuQXBwLm5hdldpbikge1xuICAgICAgICAgICAgICAgICAgICBUaS5BcHAubmF2V2luLm9wZW5XaW5kb3coY3JlYXRlVHdlZXREZXRhaWxWaWV3KGUucm93LnR3ZWV0KSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlVHdlZXREZXRhaWxWaWV3KGUucm93LnR3ZWV0KS5vcGVuKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB3aW4uYWRkKHRhYmxlVmlldyk7XG5cbiAgICAgICAgZm9yWW91TGFiZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGN1cnJlbnRUYWIgPSAwO1xuICAgICAgICAgICAgZm9yWW91TGFiZWwuZm9udCA9IHsgZm9udFNpemU6IDE2LCBmb250V2VpZ2h0OiAnYm9sZCcgfTtcbiAgICAgICAgICAgIGZvcllvdUxhYmVsLmNvbG9yID0gJyNmZmYnO1xuICAgICAgICAgICAgZm9sbG93aW5nTGFiZWwuZm9udCA9IHsgZm9udFNpemU6IDE2LCBmb250V2VpZ2h0OiAnbm9ybWFsJyB9O1xuICAgICAgICAgICAgZm9sbG93aW5nTGFiZWwuY29sb3IgPSAnIzg4OCc7XG4gICAgICAgICAgICB0YWJsZVZpZXcuc2V0RGF0YShmb3JZb3VSb3dzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvbGxvd2luZ0xhYmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjdXJyZW50VGFiID0gMTtcbiAgICAgICAgICAgIGZvcllvdUxhYmVsLmZvbnQgPSB7IGZvbnRTaXplOiAxNiwgZm9udFdlaWdodDogJ25vcm1hbCcgfTtcbiAgICAgICAgICAgIGZvcllvdUxhYmVsLmNvbG9yID0gJyM4ODgnO1xuICAgICAgICAgICAgZm9sbG93aW5nTGFiZWwuZm9udCA9IHsgZm9udFNpemU6IDE2LCBmb250V2VpZ2h0OiAnYm9sZCcgfTtcbiAgICAgICAgICAgIGZvbGxvd2luZ0xhYmVsLmNvbG9yID0gJyNmZmYnO1xuICAgICAgICAgICAgdGFibGVWaWV3LnNldERhdGEoZm9sbG93aW5nUm93cyk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgKGVycm9yKSA9PiB7XG4gICAgICAgIGFsZXJ0KCdFcnJvciBsb2FkaW5nIHR3ZWV0cyEnKTtcbiAgICB9KTtcblxuICAgIC8vIC0tLSBCT1RUT00gTkFWSUdBVElPTiBCQVIgKGxvY2FsIFBORyBpY29ucykgLS0tXG4gICAgY29uc3QgbmF2QmFyID0gVGkuVUkuY3JlYXRlVmlldyh7XG4gICAgICAgIGxlZnQ6IDAsIHJpZ2h0OiAwLFxuICAgICAgICBib3R0b206IDAsXG4gICAgICAgIGhlaWdodDogTkFWX0JBUl9IRUlHSFQsXG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJyMwMDAnLFxuICAgICAgICB6SW5kZXg6IDUwMCxcbiAgICAgICAgbGF5b3V0OiAnaG9yaXpvbnRhbCdcbiAgICB9KTtcblxuICAgIC8vIFVzZSBsb2NhbCBwYXRocyBmb3IgaWNvbnMgKG1hdGNoaW5nIHlvdXIgc2NyZWVuc2hvdClcbiAgICBjb25zdCBuYXZJY29ucyA9IFtcbiAgICAgICAgeyBwYXRoOiAnL2Fzc2V0cy9pbWFnZXMvaG9tZS5wbmcnLCBsYWJlbDogJ0hvbWUnIH0sXG4gICAgICAgIHsgcGF0aDogJy9hc3NldHMvaW1hZ2VzL3NlYXJjaC5wbmcnLCBsYWJlbDogJ1NlYXJjaCcgfSxcbiAgICAgICAgeyBwYXRoOiAnL2Fzc2V0cy9pbWFnZXMvbm90aWZpY2F0aW9uLnBuZycsIGxhYmVsOiAnTm90aWZpY2F0aW9ucycgfSxcbiAgICAgICAgeyBwYXRoOiAnL2Fzc2V0cy9pbWFnZXMvbWVzc2FnZXMucG5nJywgbGFiZWw6ICdNZXNzYWdlcycgfVxuICAgIF07XG5cbiAgICBuYXZJY29ucy5mb3JFYWNoKGZ1bmN0aW9uKGljb25PYmopIHtcbiAgICAgICAgY29uc3QgaWNvbkJ0biA9IFRpLlVJLmNyZWF0ZVZpZXcoe1xuICAgICAgICAgICAgd2lkdGg6IFRpLlBsYXRmb3JtLmRpc3BsYXlDYXBzLnBsYXRmb3JtV2lkdGggLyBuYXZJY29ucy5sZW5ndGgsXG4gICAgICAgICAgICBoZWlnaHQ6IE5BVl9CQVJfSEVJR0hULFxuICAgICAgICAgICAgbGF5b3V0OiAndmVydGljYWwnXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBpY29uID0gVGkuVUkuY3JlYXRlSW1hZ2VWaWV3KHtcbiAgICAgICAgICAgIGltYWdlOiBpY29uT2JqLnBhdGgsXG4gICAgICAgICAgICB3aWR0aDogMjgsIGhlaWdodDogMjgsXG4gICAgICAgICAgICB0b3A6IDEzXG4gICAgICAgIH0pO1xuICAgICAgICBpY29uQnRuLmFkZChpY29uKTtcbiAgICAgICAgaWNvbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3QgZHVtbXlXaW4gPSBUaS5VSS5jcmVhdGVXaW5kb3coe1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyMwMDAnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBpY29uT2JqLmxhYmVsLFxuICAgICAgICAgICAgICAgIG5hdkJhckhpZGRlbjogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKFRpLkFwcC5uYXZXaW4pIFRpLkFwcC5uYXZXaW4ub3BlbldpbmRvdyhkdW1teVdpbik7XG4gICAgICAgICAgICBlbHNlIGR1bW15V2luLm9wZW4oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG5hdkJhci5hZGQoaWNvbkJ0bik7XG4gICAgfSk7XG5cbiAgICB3aW4uYWRkKG5hdkJhcik7XG5cbiAgICByZXR1cm4gd2luO1xufTtcbiJdLCJ2ZXJzaW9uIjozfQ==
